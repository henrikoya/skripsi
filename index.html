
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui">
    <title>Colorpicker demo</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <style type="text/css">
    /*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */
    /**
 * 1. Set default font family to sans-serif.
 * 2. Prevent iOS and IE text size adjust after device orientation change,
 *    without disabling user zoom.
 */
    
    html {
        font-family: sans-serif;
        /* 1 */
        -ms-text-size-adjust: 100%;
        /* 2 */
        -webkit-text-size-adjust: 100%;
        /* 2 */
    }
    /**
 * Remove default margin.
 */
    
    body {
        margin: 0;
    }
    /* HTML5 display definitions
   ========================================================================== */
    /**
 * Correct `block` display not defined for any HTML5 element in IE 8/9.
 * Correct `block` display not defined for `details` or `summary` in IE 10/11
 * and Firefox.
 * Correct `block` display not defined for `main` in IE 11.
 */
    
    article,
    aside,
    details,
    figcaption,
    figure,
    footer,
    header,
    hgroup,
    main,
    menu,
    nav,
    section,
    summary {
        display: block;
    }
    /**
 * 1. Correct `inline-block` display not defined in IE 8/9.
 * 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.
 */
    
    audio,
    canvas,
    progress,
    video {
        display: inline-block;
        /* 1 */
        vertical-align: baseline;
        /* 2 */
    }
    /**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */
    
    audio:not([controls]) {
        display: none;
        height: 0;
    }
    /**
 * Address `[hidden]` styling not present in IE 8/9/10.
 * Hide the `template` element in IE 8/9/10/11, Safari, and Firefox < 22.
 */
    
    [hidden],
    template {
        display: none;
    }
    /* Links
   ========================================================================== */
    /**
 * Remove the gray background color from active links in IE 10.
 */
    
    a {
        background-color: transparent;
    }
    /**
 * Improve readability of focused elements when they are also in an
 * active/hover state.
 */
    
    a:active,
    a:hover {
        outline: 0;
    }
    /* Text-level semantics
   ========================================================================== */
    /**
 * Address styling not present in IE 8/9/10/11, Safari, and Chrome.
 */
    
    abbr[title] {
        border-bottom: 1px dotted;
    }
    /**
 * Address style set to `bolder` in Firefox 4+, Safari, and Chrome.
 */
    
    b,
    strong {
        font-weight: bold;
    }
    /**
 * Address styling not present in Safari and Chrome.
 */
    
    dfn {
        font-style: italic;
    }
    /**
 * Address variable `h1` font-size and margin within `section` and `article`
 * contexts in Firefox 4+, Safari, and Chrome.
 */
    
    h1 {
        font-size: 2em;
        margin: 0.67em 0;
    }
    /**
 * Address styling not present in IE 8/9.
 */
    
    mark {
        background: #ff0;
        color: #000;
    }
    /**
 * Address inconsistent and variable font size in all browsers.
 */
    
    small {
        font-size: 80%;
    }
    /**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */
    
    sub,
    sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
    }
    
    sup {
        top: -0.5em;
    }
    
    sub {
        bottom: -0.25em;
    }
    /* Embedded content
   ========================================================================== */
    /**
 * Remove border when inside `a` element in IE 8/9/10.
 */
    
    img {
        border: 0;
    }
    /**
 * Correct overflow not hidden in IE 9/10/11.
 */
    
    svg:not(:root) {
        overflow: hidden;
    }
    /* Grouping content
   ========================================================================== */
    /**
 * Address margin not present in IE 8/9 and Safari.
 */
    
    figure {
        margin: 1em 40px;
    }
    /**
 * Address differences between Firefox and other browsers.
 */
    
    hr {
        box-sizing: content-box;
        height: 0;
    }
    /**
 * Contain overflow in all browsers.
 */
    
    pre {
        overflow: auto;
    }
    /**
 * Address odd `em`-unit font size rendering in all browsers.
 */
    
    code,
    kbd,
    pre,
    samp {
        font-family: monospace, monospace;
        font-size: 1em;
    }
    /* Forms
   ========================================================================== */
    /**
 * Known limitation: by default, Chrome and Safari on OS X allow very limited
 * styling of `select`, unless a `border` property is set.
 */
    /**
 * 1. Correct color not being inherited.
 *    Known issue: affects color of disabled elements.
 * 2. Correct font properties not being inherited.
 * 3. Address margins set differently in Firefox 4+, Safari, and Chrome.
 */
    
    button,
    input,
    optgroup,
    select,
    textarea {
        color: inherit;
        /* 1 */
        font: inherit;
        /* 2 */
        margin: 0;
        /* 3 */
    }
    /**
 * Address `overflow` set to `hidden` in IE 8/9/10/11.
 */
    
    button {
        overflow: visible;
    }
    /**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Firefox, IE 8/9/10/11, and Opera.
 * Correct `select` style inheritance in Firefox.
 */
    
    button,
    select {
        text-transform: none;
    }
    /**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 */
    
    button,
    html input[type="button"],
    input[type="reset"],
    input[type="submit"] {
        -webkit-appearance: button;
        /* 2 */
        cursor: pointer;
        /* 3 */
    }
    /**
 * Re-set default cursor for disabled elements.
 */
    
    button[disabled],
    html input[disabled] {
        cursor: default;
    }
    /**
 * Remove inner padding and border in Firefox 4+.
 */
    
    button::-moz-focus-inner,
    input::-moz-focus-inner {
        border: 0;
        padding: 0;
    }
    /**
 * Address Firefox 4+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */
    
    input {
        line-height: normal;
    }
    /**
 * It's recommended that you don't attempt to style these elements.
 * Firefox's implementation doesn't respect box-sizing, padding, or width.
 *
 * 1. Address box sizing set to `content-box` in IE 8/9/10.
 * 2. Remove excess padding in IE 8/9/10.
 */
    
    input[type="checkbox"],
    input[type="radio"] {
        box-sizing: border-box;
        /* 1 */
        padding: 0;
        /* 2 */
    }
    /**
 * Fix the cursor style for Chrome's increment/decrement buttons. For certain
 * `font-size` values of the `input`, it causes the cursor style of the
 * decrement button to change from `default` to `text`.
 */
    
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        height: auto;
    }
    /**
 * 1. Address `appearance` set to `searchfield` in Safari and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari and Chrome.
 */
    
    input[type="search"] {
        -webkit-appearance: textfield;
        /* 1 */
        box-sizing: content-box;
        /* 2 */
    }
    /**
 * Remove inner padding and search cancel button in Safari and Chrome on OS X.
 * Safari (but not Chrome) clips the cancel button when the search input has
 * padding (and `textfield` appearance).
 */
    
    input[type="search"]::-webkit-search-cancel-button,
    input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none;
    }
    /**
 * Define consistent border, margin, and padding.
 */
    
    fieldset {
        border: 1px solid #c0c0c0;
        margin: 0 2px;
        padding: 0.35em 0.625em 0.75em;
    }
    /**
 * 1. Correct `color` not being inherited in IE 8/9/10/11.
 * 2. Remove padding so people aren't caught out if they zero out fieldsets.
 */
    
    legend {
        border: 0;
        /* 1 */
        padding: 0;
        /* 2 */
    }
    /**
 * Remove default vertical scrollbar in IE 8/9/10/11.
 */
    
    textarea {
        overflow: auto;
    }
    /**
 * Don't inherit the `font-weight` (applied by a rule above).
 * NOTE: the default cannot safely be changed in Chrome and Safari on OS X.
 */
    
    optgroup {
        font-weight: bold;
    }
    /* Tables
   ========================================================================== */
    /**
 * Remove most spacing between table cells.
 */
    
    table {
        border-collapse: collapse;
        border-spacing: 0;
    }
    
    td,
    th {
        padding: 0;
    }
    
    *,
    *:after,
    *:before {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    
    html {
        height: 100%;
        font-size: 62.5%;
    }
    
    body {
        font-family: Helvetica, Arial, Sans-serif;
        font-size: 1.4em;
        line-height: 1.5;
        height: 100%;
    }
    
    body > div {
        font-size: 1.4rem;
    }
    
    .layout {
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-flex-direction: column;
        -ms-flex-direction: column;
        flex-direction: column;
        height: 100%;
    }
    
    .content {
        background-color: #000;
        color: black;
        overflow: hidden;
        -webkit-box-flex: 1;
        -webkit-flex: 1 1 0px;
        -ms-flex: 1 1 0px;
        flex: 1 1 0px;
        height: 0px;
    }
    
    .wrapper {
        width: 100%;
        height: 100%;
        height: 100vh;
        overflow-x: hidden;
        overflow-y: auto;
    }
    
    .container {
        margin: 0 auto;
    }
    
    .canvas-wrapper {
        position: relative;
        width: 100%;
        /*height: 0;
  padding-bottom: 75%;*/
        overflow: hidden;
    }
    
    .canvas-content {
        top: 0;
        left: 0;
    }
    
    #c {
        display: block;
    }
    
    .output-block {
        overflow: hidden;
        border-bottom: solid .1rem #e6e6e6;
        border-top: solid .1rem #e6e6e6;
    }
    
    .output-content {
        border-bottom: solid .1rem #eee;
    }
    
    .output-content:last-of-type {
        border: 0;
    }
    
    .output-content input[type=text] {
        border: 0;
        display: block;
        margin: 0;
        font: inherit;
    }
    
    .color-list__head {
        display: table;
        width: 100%;
        border-bottom: solid .2rem #e6e6e6;
    }
    
    .color-list__hex {
        display: table-cell;
        vertical-align: middle;
        padding: .8rem 1.2rem;
        border-right: solid .1rem #e6e6e6;
        width: 8rem;
    }
    
    .color-list__rgb {
        display: table-cell;
        vertical-align: middle;
        padding: .8rem 1.2rem;
        border-right: solid .1rem #e6e6e6;
        width: 50%;
        white-space: nowrap;
    }
    
    .color-list__lab {
        display: table-cell;
        vertical-align: middle;
        padding: .8rem 1.2rem;
        width: 50%;
        white-space: nowrap;
    }
    </style>
</head>

<body>
    <div class="layout">
        <div class="content">
            <div class="container">
                <div class="canvas-wrapper">
                    <canvas width="480" height="600" id="c" style="margin:0 auto;"></canvas>
                </div>
            </div>
        </div>
        <div class="output">
            <div class="container">
                <!--  <div id="hex">HEX:
                    <input type="text"></input>
                </div> -->
                <div class="output-block">
                    <div class="output-content" id="hex">
                        <div style="display: table;width:100%;">
                            <div style="display: table-cell;vertical-align: middle;width: 8rem;border-right: solid .1rem #eee;padding:.6rem 1.2rem;">HEX</div>
                            <div style="display: table-cell;vertical-align: middle;padding:.6rem 1.2rem;">
                                <input type="text" class="output-text" readonly style="width: 100%;display: block;"><input>
                            </div>
                            <div style="width:1%;display: table-cell;vertical-align: middle;padding:.6rem 1.2rem;">
                                <div id="prev" style="width: 2rem;height: 2rem"></div>
                            </div>
                        </div>
                    </div>
                    <div class="output-content" id="rgb">
                        <div style="display: table;width:100%;">
                            <div style="display: table-cell;vertical-align: middle;width: 8rem;border-right: solid .1rem #eee;padding:.6rem 1.2rem;">RGB</div>
                            <div style="display: table-cell;vertical-align: middle;padding:.6rem 1.2rem;">
                                <input type="text" class="output-text" readonly style="width: 100%;display: block;"><input>
                            </div>
                        </div>
                    </div>
                    <div class="output-content" id="lab">
                        <div style="display: table;width:100%;">
                            <div style="display: table-cell;vertical-align: middle;width: 8rem;border-right: solid .1rem #eee;padding:.6rem 1.2rem;">LAB</div>
                            <div style="display: table-cell;vertical-align: middle;padding:.6rem 1.2rem;">
                                <input type="text" class="output-text" readonly style="width: 100%;display: block;"><input>
                            </div>
                        </div>
                    </div>

                    <div class="output-content" id="Lycopene">
                        <div style="display: table;width:100%;">
                            <div style="display: table-cell;vertical-align: middle;width: 8rem;border-right: solid .1rem #eee;padding:.6rem 1.2rem;">Lycopene</div>
                            <div style="display: table-cell;vertical-align: middle;padding:.6rem 1.2rem;">
                                <input type="text" class="output-text" readonly style="width: 100%;display: block;"><input>
                            </div>
                        </div>
                    </div>
					   <div class="output-content" id="Brix">
                        <div style="display: table;width:100%;">
                            <div style="display: table-cell;vertical-align: middle;width: 8rem;border-right: solid .1rem #eee;padding:.6rem 1.2rem;">Brix</div>
                            <div style="display: table-cell;vertical-align: middle;padding:.6rem 1.2rem;">
                                <input type="text" class="output-text" readonly style="width: 100%;display: block;"><input>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <script type="text/javascript">
        // Closure
        (function() {
            /**
             * Decimal adjustment of a number.
             *
             * @param {String}  type  The type of adjustment.
             * @param {Number}  value The number.
             * @param {Integer} exp   The exponent (the 10 logarithm of the adjustment base).
             * @returns {Number} The adjusted value.
             */
            function decimalAdjust(type, value, exp) {
                // If the exp is undefined or zero...
                if (typeof exp === 'undefined' || +exp === 0) {
                    return Math[type](value);
                }
                value = +value;
                exp = +exp;
                // If the value is not a number or the exp is not an integer...
                if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {
                    return NaN;
                }
                // Shift
                value = value.toString().split('e');
                value = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));
                // Shift back
                value = value.toString().split('e');
                return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));
            }

            // Decimal round
            if (!Math.round10) {
                Math.round10 = function(value, exp) {
                    return decimalAdjust('round', value, exp);
                };
            }
            // Decimal floor
            if (!Math.floor10) {
                Math.floor10 = function(value, exp) {
                    return decimalAdjust('floor', value, exp);
                };
            }
            // Decimal ceil
            if (!Math.ceil10) {
                Math.ceil10 = function(value, exp) {
                    return decimalAdjust('ceil', value, exp);
                };
            }



        })();





        fixScale = function(doc) {

            var addEvent = 'addEventListener',
                type = 'gesturestart',
                qsa = 'querySelectorAll',
                scales = [1, 1],
                meta = qsa in doc ? doc[qsa]('meta[name=viewport]') : [];

            function fix() {
                meta.content = 'width=device-width,minimum-scale=' + scales[0] + ',maximum-scale=' + scales[1];
                doc.removeEventListener(type, fix, true);
            }

            if ((meta = meta[meta.length - 1]) && addEvent in doc) {
                fix();
                scales = [.25, 1.6];
                doc[addEvent](type, fix, true);
            }

        };



        window.URL = window.URL || window.webkitURL

        navigator.getUserMedia = navigator.getUserMedia ||
            navigator.webkitGetUserMedia ||
            navigator.mozGetUserMedia ||
            navigator.msGetUserMedia

        window.requestAnimationFrame = window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.msRequestAnimationFrame ||
            window.oRequestAnimationFrame

        function camvas(ctx, drawFunc) {
            var self = this
            this.ctx = ctx
            this.draw = drawFunc

            var streamContainer = document.createElement('div')
            this.video = document.createElement('video')

            this.video.setAttribute('autoplay', '1')

            this.video.setAttribute('width', this.ctx.canvas.width)
            this.video.setAttribute('height', this.ctx.canvas.height)

            this.video.setAttribute('style', 'display:none')
            streamContainer.appendChild(this.video)
            document.body.appendChild(streamContainer)

            // The callback happens when we are starting to stream the video.
            navigator.getUserMedia({
                video: true
            }, function(stream) {
                // Yay, now our webcam input is treated as a normal video and
                // we can start having fun
                self.video.src = window.URL.createObjectURL(stream)
                    // Let's start drawing the canvas!
                self.update()
            }, function(err) {
                throw err
            })

            // As soon as we can draw a new frame on the canvas, we call the `draw` function 
            // we passed as a parameter.
            this.update = function() {
                var self = this
                var last = Date.now()
                var loop = function() {
                    // For some effects, you might want to know how much time is passed
                    // since the last frame; that's why we pass along a Delta time `dt`
                    // variable (expressed in milliseconds)
                    var dt = Date.now - last
                    self.draw(self.video, dt)
                    last = Date.now()
                    requestAnimationFrame(loop)
                }
                requestAnimationFrame(loop)
            }
        }





        // # Example call for the demo at http//cbrandolino.github.com/camvas

        // If the browser does not support any URL, getUserMedia or
        // In this example call, we will directly draw the webcam stream on a canvas.


        function rgbToHex(R, G, B) {
            return toHex(R) + toHex(G) + toHex(B)
        }

        function toHex(n) {
            n = parseInt(n, 10);
            if (isNaN(n)) return "00";
            n = Math.max(0, Math.min(n, 255));
            return "0123456789ABCDEF".charAt((n - n % 16) / 16) + "0123456789ABCDEF".charAt(n % 16);
        }


        function RGBtoXYZ(R, G, B) {
            var_R = parseFloat(R / 255) //R from 0 to 255
            var_G = parseFloat(G / 255) //G from 0 to 255
            var_B = parseFloat(B / 255) //B from 0 to 255

            if (var_R > 0.04045) var_R = Math.pow(((var_R + 0.055) / 1.055), 2.4)
            else var_R = var_R / 12.92
            if (var_G > 0.04045) var_G = Math.pow(((var_G + 0.055) / 1.055), 2.4)
            else var_G = var_G / 12.92
            if (var_B > 0.04045) var_B = Math.pow(((var_B + 0.055) / 1.055), 2.4)
            else var_B = var_B / 12.92

            var_R = var_R * 100
            var_G = var_G * 100
            var_B = var_B * 100

            //Observer. = 2°, Illuminant = D65
            X = var_R * 0.4124 + var_G * 0.3576 + var_B * 0.1805
            Y = var_R * 0.2126 + var_G * 0.7152 + var_B * 0.0722
            Z = var_R * 0.0193 + var_G * 0.1192 + var_B * 0.9505
            return [X, Y, Z]
        }


        function XYZtoLAB(x, y, z) {
            var ref_X = 95.047;
            var ref_Y = 100.000;
            var ref_Z = 108.883;

            var_X = x / ref_X //ref_X =  95.047   Observer= 2°, Illuminant= D65
            var_Y = y / ref_Y //ref_Y = 100.000
            var_Z = z / ref_Z //ref_Z = 108.883

            if (var_X > 0.008856) var_X = Math.pow(var_X, (1 / 3))
            else var_X = (7.787 * var_X) + (16 / 116)
            if (var_Y > 0.008856) var_Y = Math.pow(var_Y, (1 / 3))
            else var_Y = (7.787 * var_Y) + (16 / 116)
            if (var_Z > 0.008856) var_Z = Math.pow(var_Z, (1 / 3))
            else var_Z = (7.787 * var_Z) + (16 / 116)

            CIE_L = (116 * var_Y) - 16
            CIE_a = 500 * (var_X - var_Y)
            CIE_b = 200 * (var_Y - var_Z)

            round_L = Math.floor10(CIE_L, -2)
            round_a = Math.floor10(CIE_a, -2)
            round_b = Math.floor10(CIE_b, -2)

            return [round_L, round_a, round_b]
        }



        window.onload = function() {
            var ctx = document.getElementById('c').getContext('2d')
            var draw = function(video, dt) {
                ctx.drawImage(video, 0, 0)
            }
            var myCamvas = new camvas(ctx, draw);

            $('#c').click(function(event) {
                // getting user coordinates
                var x = event.pageX - this.offsetLeft;
                var y = event.pageY - this.offsetTop;
                // getting image data and RGB values
                var img_data = ctx.getImageData(x, y, 1, 1).data;
                var R = img_data[0];
                var G = img_data[1];
                var B = img_data[2];
                var rgb = R + ',' + G + ',' + B;
                // convert RGB to HEX
                var hex = rgbToHex(R, G, B);



                // user colour
                var Red = R;
                var Green = G;
                var Blue = B;

                // user colour converted to XYZ space
                XYZ = RGBtoXYZ(Red, Green, Blue)
                var colX = XYZ[0];
                var colY = XYZ[1];
                var colZ = XYZ[2];

                //convert to LAB

              
                LAB = XYZtoLAB(colX, colY, colZ)



                // formula

                var Lycopene = 84.945+1.378*round_L+4.514*round_a-1.132*round_b

                // formula

                var Brix = 4.156-0.021*round_L+0.003*round_a+0.012*round_b

                // making the color the value of the input
                $('#rgb input').val(rgb);
                $('#hex input').val('#' + hex);
                $('#lab input').val(LAB);
                $('#Lycopene input').val(Lycopene);
				$('#Brix input').val(Brix);

                var bgHex = '#' + hex;

                $('#prev').css('background-color', bgHex);




                //$('.color-list__body').prepend('<div class="color-list__row"><div class="color-list__hex"><div style="width:2rem;height:2rem;background:#' + hex + ';"></div></div><div class="color-list__rgb">' + rgb + '</div><div class="color-list__lab">' + LAB + '</div></div>');
            });
        }
        </script>
    </div>
</body>

</html>
